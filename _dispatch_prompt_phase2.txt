# Phase 2: Implementation

## CRITICAL: TRUST THE SPEC

The specification below is COMPLETE. Do not:
- Read README, ARCHITECTURE, or documentation files
- Search for patterns or conventions in the codebase
- Explore directory structures
- Read files unrelated to your implementation

Only read files that:
1. You need to import from (check the target path's neighbors)
2. Contain types/classes referenced in the interface
3. The test file at the specified path

The spec tells you exactly what to build. Trust it.

## CIRCUIT BREAKER

If you have made 8+ file reads without writing any code, STOP.
You are exploring instead of implementing. The spec is complete.
Write the implementation now with what you know.

## CRITICAL CONSTRAINT: DO NOT MODIFY TESTS

You are FORBIDDEN from modifying the test file.
The tests at the path below are fixed and immutable.
Your task is to make them pass, not to change them.
Do not edit, delete, or modify any test code.

## TEST FILE LOCATION: `tests/test_singlephasespecexecution.py`

Read this file to understand what you must implement.
Then implement the code to make all tests pass.

## THE SPECIFICATION

# Specification: SinglePhaseSpecExecution
Tier: FEATURE

## Description
Refactor the two-phase spec system into a single phase where implementation comes first, then tests are derived from the spec's requirements.

## Interface
- `SpecPhaseRunner.get_request(self) -> PhaseRequest` — Returns single unified request (replaces get_phase1_request/get_phase2_request)
- `SpecPhaseRunner.complete(self, success: bool) -> None` — Marks execution complete (replaces complete_phase1)
- `SpecPromptBuilder.build_prompt(self, spec: SpecDocument) -> str` — Single unified prompt (replaces build_phase1_prompt/build_phase2_prompt)
- Remove `infer_test_path`, `get_phase2_request`, `complete_phase1` methods

## Must Do
- Single CLI invocation per spec (not two phases)
- Prompt instructs agent to: 1) implement the interface, 2) write tests that verify each "Must Do" item, 3) write tests for each "Edge Case"
- Tests validate contract/behavior, not implementation details
- Remove all phase tracking state from SpecPhaseRunner
- Update gui_viewer.py to call single phase instead of phase loop
- Update dispatch/handler.py if it references phase methods

## Must Not Do
- Do not generate tests before implementation exists
- Do not invent test cases beyond what spec defines
- Do not break prose mode (non-spec) dispatch flow
- Do not modify TaskTracker or task contracts

## Edge Cases
- Spec with empty "Edge Cases" section → still generate tests for "Must Do" items only
- Spec with no "Must Do" section → validation should catch this (already handled by validator)
- GUI closes mid-execution → same handling as current (process cleanup)

## Validation
- Tests: pytest tests/ -v

## Target Path
src/specs/

## YOUR TASK

Implement the specification at: `src/specs/`

Implementation Rules:
1. Follow interface signatures EXACTLY
2. Implement minimal code to pass all tests
3. Handle all edge cases as specified
4. Ensure preconditions are checked
5. Ensure postconditions are satisfied

Run the tests and iterate until all pass.
Test command: pytest tests/ -v

Write clean, scalable, modular, efficient code. Follow single responsibility principle. Do not repeat yourself. Use consistent naming conventions. No unnecessary comments.